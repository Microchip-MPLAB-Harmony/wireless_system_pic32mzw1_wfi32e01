<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="Web Socket System Service Developer's Guide" />
<meta name="DC.relation" scheme="URI" content="GUID-097A4209-8474-480E-A141-6C8FC60A7671.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="web-socket-system-service-developers-guide" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<title>Web Socket System Service Developer's Guide</title>
<meta name="Microsoft.Help.Id" content="GUID-2B8E373F-A339-4F88-A864-07460CC2D917" />
<meta name="Microsoft.Help.TocParent" content="GUID-2B8E373F-A339-4F88-A864-07460CC2D917" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLAB Harmony PIC32MZW1/WFI32 wireless system services Reference A 03/2023" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
         
         function copyContent(content, button) {
         
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                     button.textContent = "Copy";
                     button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
               console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
         }
         
         function cpy(id, button) {
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            
            copyContent(content, button);
         }
         
         document.addEventListener("DOMContentLoaded", function(event) {
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.style.position = "relative";
               var copy = document.createElement("button");
               copy.textContent = "Copy";
               copy.setAttribute("class", "copy-code");
               
               var content = elem.textContent;
               
               copy.addEventListener("click", function(){
                  copyContent(content, copy);
               });
               
               elem.addEventListener("mouseenter", function(evt){
                  elem.prepend(copy);
               });
            });
            
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.addEventListener("mouseleave", function(evt){
                  document.querySelector(".copy-code").remove();
               });
            });
         });
         
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /></head>
<body>
<div class="nested0" aria-labelledby="ariaid-title1" id="web-socket-system-service-developers-guide"><h1 class="title topictitle1" id="ariaid-title1" style="">Web Socket System Service Developer's Guide</h1><div class="body"><p class="p">The purpose of this document is to explain the Web Socket system service design to enable the developer to make changes in the service code as per his/ her requirements if the need be.</p>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-097A4209-8474-480E-A141-6C8FC60A7671.html">Web Socket Server (WSS) System Service</a></div>
</div>
</div></div>
<div class="topic nested0" aria-labelledby="ariaid-title2" id="overview"><h1 class="title topictitle1" id="ariaid-title2" style="">Overview</h1><div class="body"><p class="p">The WSS service provides an application programming interface (API) to manage the Web Socket functionalities over TCP/IP Networking. The WSS service uses the MPLAB Harmony NET system service to achieve the TCPIP functionalities.</p>
<p class="p">Key Features:</p>
<ul class="ul"><li class="li"><p class="p">Implements the WSS protocol as a service</p>
</li>
<li class="li"><p class="p">Supports both Server and Client modes</p>
</li>
<li class="li"><p class="p">Supports multiple client connections simultaneously in Server mode</p>
</li>
</ul>
<br /><img class="image" src="GUID-8A3E5461-1898-40FE-A45F-9AA5072EC79F-low.png" alt="Abstraction_new" /><br /></div>
</div>
<div class="topic nested0" aria-labelledby="ariaid-title3" id="detailed-design"><h1 class="title topictitle1" id="ariaid-title3" style="">Detailed Design</h1><div class="body"><p class="p">WSS system service is a background service with which the application can interact using the APIs provided. The idea of the WSS service is to reduce the code size for the application and simplifying the state machine that the application may need to maintain by abstracting out the complexity of the Web Socket protocol in the system service.</p>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title4" id="state-machine"><h2 class="title topictitle2" id="ariaid-title4" style="">State Machine</h2><div class="body"><p class="p">The various states of the WSS service are of the enum type <a class="xref" href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/system/wss/docs/interface.html#SYS_WSS_STATE" target="_blank"><em class="ph i">SYS_WSS_STATE</em></a>.</p>
<p class="p">The WSS system service runs a finite state machine with the following states:</p>
<ol class="ol"><li class="li"><span class="indent-level-default">1.</span><p class="p"><em class="ph i">SYS_WSS_STATE_CLOSED</em>   : Initial State of the WSS service, at the initialization.</p>
</li>
<li class="li"><span class="indent-level-default">2.</span><p class="p"><em class="ph i">SYS_WSS_STATE_CLOSING</em>  : An intermediate state which handles the processing of the closing handshake .</p>
</li>
<li class="li"><span class="indent-level-default">3.</span><p class="p"><em class="ph i">SYS_WSS_STATE_CONNECTING</em>  : An intermediate state which handles the processing of the opening handshake.</p>
</li>
<li class="li"><span class="indent-level-default">4.</span><p class="p"><em class="ph i">SYS_WSS_STATE_CONNECTED</em>  : The state which handles all the data transmissions.</p>
</li>
</ol>
<br /><img class="image" src="GUID-0B235250-D27B-4B4E-8BD4-28340059E3E3-low.png" alt="StateMachine" /><br /></div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title5" id="number-of-clients-supported"><h2 class="title topictitle2" id="ariaid-title5" style="">Number of Clients Supported</h2><div class="body"><p class="p">The maximum number of Clients supported in the server mode by WSS service currently is 8. The user can change the value via the MCC. Default the value is set to 2.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title6" id="connection-time-out"><h2 class="title topictitle2" id="ariaid-title6" style="">Connection time out</h2><div class="body"><p class="p">The user can configure a timeout value which will be considered as a maximum idle time for a connection. The default timeout value is 30s.</p>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title7" id="api-implementation"><h2 class="title topictitle2" id="ariaid-title7" style="">API Implementation</h2><div class="body"><p class="p">This section describes the high level implementation details of the WSS APIs.</p>
</div>
<div class="topic nested2" aria-labelledby="ariaid-title8" id="sys-wss-register-callback"><h3 class="title topictitle3" id="ariaid-title8" style="">SYS_WSS_register_callback()</h3><div class="body"><p class="p">The API is used for registering the application callback function with the WSS service.</p>
<br /><img class="image" src="GUID-A1B629B9-87F7-4C28-9DE8-CC5867A72EC6-low.png" alt="SYS_WSS_register_callback_new" /><br /></div>
</div>
<div class="topic nested2" aria-labelledby="ariaid-title9" id="sys-wss-closeconnection"><h3 class="title topictitle3" id="ariaid-title9" style="">SYS_WSS_CloseConnection()</h3><div class="body"><p class="p">This API is used to close the Web Socket connection to the client indicated by the parameter <code class="ph codeph">clientIndex</code>. This will initiate the closing handshake from the server.</p>
<br /><img class="image" src="GUID-3F8BE347-6147-48F1-8356-BEA8F8A562B0-low.png" alt="SYS_WSS_CloseConnection_new" /><br /></div>
</div>
<div class="topic nested2" aria-labelledby="ariaid-title10" id="sys-wss-pingclient"><h3 class="title topictitle3" id="ariaid-title10" style="">SYS_WSS_PingClient()</h3><div class="body"><p class="p">This API is used to send a ping message to the client indicated by the parameter clientIndex.</p>
<br /><img class="image" src="GUID-C011C3A3-2E69-41E7-9C78-8958E2A11B1F-low.png" alt="SYS_WSS_PingClient_new" /><br /></div>
</div>
<div class="topic nested2" aria-labelledby="ariaid-title11" id="sys-wss-sendmessage"><h3 class="title topictitle3" id="ariaid-title11" style="">SYS_WSS_sendMessage()</h3><div class="body"><p class="p">This API is used to send a message to the client indicated by the parameter <code class="ph codeph">clientIndex</code>.</p>
<br /><img class="image" src="GUID-47CB4C3C-9EEC-46F3-82CB-AA9563AA8D7C-low.png" alt="SYS_WSS_sendMessage_new" /><br /></div>
</div>
<div class="topic nested2" aria-labelledby="ariaid-title12" id="sys-wss-initialize--sys-wss-deinitialize"><h3 class="title topictitle3" id="ariaid-title12" style="">SYS_WSS_Initialize() / SYS_WSS_Deinitialize()</h3><div class="body"><p class="p">These functions are used for initializing/ deinitializing the data structures of the WSS system service.</p>
</div>
</div>
</div>
<div class="topic nested1" aria-labelledby="ariaid-title13" id="code-location"><h2 class="title topictitle2" id="ariaid-title13" style="">Code location</h2><div class="body"><p class="p">The base code for the WSS system service can be found in the <em class="ph i">wireless_system_pic32mzw1_wfi32e01\system\wss</em></p>
<p class="p">The same shall be copied to the following location after the code for the application is generated – <em class="ph i">my_application\firmware\src\config\pic32mz_w1_curiosity\system\wss</em></p>
<p class="p">The core includes two files:</p>
<ol class="ol"><li class="li"><span class="indent-level-default">1.</span><p class="p">Header file: <em class="ph i">sys_wss.h</em></p>
</li>
<li class="li"><span class="indent-level-default">2.</span><p class="p">Source file: <em class="ph i">src/sys_wss.c</em></p>
</li>
</ol>
<p class="p">The WSS component can also optinoally generate two application template files. The template file includes a callback that can be modified as required by the end user application.</p>
<ol class="ol"><li class="li"><span class="indent-level-default">1.</span><p class="p">Header file: <em class="ph i">app_wss.h</em></p>
</li>
<li class="li"><span class="indent-level-default">2.</span><p class="p">Source file: <em class="ph i">src/app_wss.c</em></p>
</li>
</ol>
</div>
</div>
</div>
</body>
</html>