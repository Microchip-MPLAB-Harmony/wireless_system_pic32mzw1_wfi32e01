<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="MQTT System Service Configuration" />
<meta name="DC.relation" scheme="URI" content="GUID-6D4A7590-A5FE-418D-8A39-4F13DF7618BD.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="mqtt-system-service-configuration" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<title>MQTT System Service Configuration</title>
<meta name="Microsoft.Help.Id" content="GUID-2B8E373F-A339-4F88-A864-07460CC2D917-mqtt-system-service-configuration" />
<meta name="Microsoft.Help.TocParent" content="GUID-2B8E373F-A339-4F88-A864-07460CC2D917" />
<meta name="Microsoft.Help.TocOrder" content="0" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="MPLAB Harmony PIC32MZW1/WFI32 wireless system services Reference A 03/2023" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
         
         function copyContent(content, button) {
         
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                     button.textContent = "Copy";
                     button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
               console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
         }
         
         function cpy(id, button) {
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            
            copyContent(content, button);
         }
         
         document.addEventListener("DOMContentLoaded", function(event) {
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.style.position = "relative";
               var copy = document.createElement("button");
               copy.textContent = "Copy";
               copy.setAttribute("class", "copy-code");
               
               var content = elem.textContent;
               
               copy.addEventListener("click", function(){
                  copyContent(content, copy);
               });
               
               elem.addEventListener("mouseenter", function(evt){
                  elem.prepend(copy);
               });
            });
            
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.addEventListener("mouseleave", function(evt){
                  document.querySelector(".copy-code").remove();
               });
            });
         });
         
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-226069A1-E832-4560-8457-6363E3A0EB83"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /></head>
<body id="mqtt-system-service-configuration">
<h1 class="title topictitle1" id="ariaid-title1" style="">MQTT System Service Configuration</h1><div class="body"><p class="p">The MQTT System Service library should be configured through the MHC. When user selects the MQTT System Service library, all the required dependencies components are added automatically in the MHC configuration.</p>
<p class="p">The following figure shows the MHC configuration window for configuring the MQTT System Service and a brief description of various configuration options.</p>
<ul class="ul"><li class="li"><p class="p">Open the MHC 3</p>
</li>
<li class="li"><p class="p">Drag the MQTT Service Module into the Active components from the Available components</p>
</li>
</ul>
<br /><img class="image" src="GUID-AD53ACEE-71AA-43EE-9480-8E67CD7729BA-low.png" alt="Mqtt_service_MHC" /><br /><ul class="ul"><li class="li"><p class="p">Configure the various parameters of Basic Configuration</p>
</li>
</ul>
<br /><img class="image" src="GUID-FD27AB9C-D8EE-4DEA-AF90-FD88B57C5148-low.png" alt="Mqtt_Basic_Service" /><br />
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:middle;" id="d38300e38"><span>Parameter Name</span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d38300e40"><span>Default   Value</span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d38300e42"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e38 "><span>Broker Name</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e40 "><span> </span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e42 "><span>Name of the MQTT   BrokerNote: User should ensure that the Broker is UP and running. In case the connection timesout often, the User can modify the value of SYS_MQTT_PERIOIDC_TIMEOUT as per his requirement.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e38 "><span>Server Port</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e40 "><span> </span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e42 "><span>Port   number of the MQTT Broker at which the MQTT Client should connect</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e38 "><span>Enable TLS</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e40 "><span>FALSE</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e42 "><span>If   TRUE, the MQTT connection should use TLS while connecting to the broker. If   FALSE, the MQTT connection should not use TLS.Note: In case the TLS is enabled, the User needs to update the component 'Presentation Layer' with the CA Certificate format, location, name, and size. Other parameters can be updated as per the User's requirements.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e38 "><span>Enable SNI</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e40 "><span>FALSE</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e42 "><span>Server Name Indication ff   TRUE, enables a client device to specify the domain name it is trying to reach in the first step of the TLS handshake.Note: In case the SNI is enabled, the Broker Name is taken as the Domain Name.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e38 "><span>Enable ALPN</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e40 "><span>FALSE</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e42 "><span>Application-Layer Protocol Negotiation (ALPN) is a TLS extension that allows the application layer to negotiate which protocol should be performed over a secure connection in a manner that avoids additional round trips and which is independent of the application-layer protocols</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e38 "><span>Client Id</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e40 "><span> </span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e42 "><span>MQTT   Client Id should be unique for the Broker. If left empty, the Id will be   generated randomly</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e38 "><span>Network Interface</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e40 "><span> </span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e42 "><span>Network Interface - Wifi or Ethernet on which the MQTT Client should run. On choosing Ethernet, the MHC will add EthMAC, MIIM, and LAM8740 Components. The User needs to attach the EthMAC to the NetConfig (in System Component Window) via the MAC parameter in Instance 1</span></td>
</tr>
</tbody>
</table>
</div>
<br /><img class="image" src="GUID-83C3E0C9-D868-421A-A644-D724B9CFE414-low.png" alt="Net_service_netconfig" /><br /><ul class="ul"><li class="li"><p class="p">Configure the various parameters of Presentation Layer if TLS enabled</p>
</li>
</ul>
<br /><img class="image" src="GUID-27F7971A-FD7E-4B48-8162-3167095CC705-low.png" alt="presentation_layer" /><br /><ul class="ul"><li class="li"><p class="p">Configure the various parameters of 'Advanced Configuration' of the MQTT Service</p>
</li>
</ul>
<br /><img class="image" src="GUID-969D2DE1-C99B-4044-8239-B17464009D26-low.png" alt="Mqtt_Adv_Service" /><br />
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:middle;" id="d38300e119"><span>Parameter Name</span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d38300e121"><span>Default   Value</span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d38300e123"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e119 "><span>Enable   Auto Reconnect</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e121 "><span>TRUE</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e123 "><span>If TRUE, the MQTT Service will auto reconnect to the Broker if   connection is broken. If FALSE, the customer application needs to take care   of triggering the connection process again.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e119 "><span>Enable   Clean Session</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e121 "><span>TRUE</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e123 "><span>If TRUE, the MQTT Client shall tell the Broker that the session is clean; else, it will let the Broker know that the session is a continuation of the previous session. Also, if “clean session” is disabled, it is valid only within a single boot session in the Client (i.e. reconnecting before the next power-on reset) and not across boots</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e119 "><span>KeepAlive Interval</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e121 "><span>60 sec</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e123 "><span>If no   data flows over an open connection for a certain KeepAliveInterval then the   client will generate a PINGREQ and expect to receive a PINGRESP from the   broker. This message exchange confirms that the connection is open and   working</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e119 "><span>Username/   Password</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e121 "><span>Disabled</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e123 "><span>In case   the connection to Broker needs a Username and Password</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e119 "><span>Last   Will and testament</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e121 "><span>Disabled</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e123 "><span>LWT   Configuration has the following parameters –          1. Topic,          2. QoS,          3. Retain, and          4. Message This   ‘Message’ will be sent on the ‘Topic’ whenever the Broker finds that there is   an ungraceful disconnection with the Client.</span></td>
</tr>
</tbody>
</table>
</div>
<ul class="ul"><li class="li"><p class="p">Configure the remaining parameters</p>
</li>
</ul>
<br /><img class="image" src="GUID-69BC2F8D-6043-4AD6-AC11-C0D54589B55E-low.png" alt="Mqtt_Remaining_Service" /><br />
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:middle;" id="d38300e175"><span>Parameter Name</span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d38300e177"><span>Default   Value</span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d38300e179"><span>Description</span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e175 "><span>Subscription Topic</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e177 "><span>Disabled</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e179 "><span>Subscription configuration has 2 Parameters –      1.	Topic and      2.	Qos. (0 (Atmost Once),                 1 (Atleast Once),                2 (Exactly Once))     The User can configure these parameters to subscribe to a Topic to receive   messages.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e175 "><span>Publish to Topic</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e177 "><span>Disabled</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e179 "><span>Publishing a message to Topic has 3 Parameters –        1. Topic and      2. Qos ( 0 (Atmost Once), 1 (Atleast Once), 2 (Exactly Once))     3. Retain: If the Broker should retain the message     The User can configure these parameters to and use them along with the   message to send it on a particular Topic.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e175 "><span>Enable CLI Commands</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e177 "><span>Enabled</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e179 "><span>Enabling this flag compiles in the CLI commands related to Mqtt Service. The user can use these CLI commands to connect/ disconnect, subscribe/ unsusbscribe, publish messages onto a topic.</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e175 "><span>Enable Debug Logs</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e177 "><span>Disabled</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d38300e179 "><span>Enabling this flag compiles in debug logs and user can enable them   at runtime. The user can use the following CLI commands to enable/ disable   levels and flows for the MQTT service:     1.	sysmqtt debug level <span class="undefined_element">      2.	sysmqtt debug flow <span class="undefined_element"> Note: In case the user enables debug logs, user needs to manually add the 'App Debug Service' component from Wireless-&gt; System Service-&gt; App Debug Service.</span></span></span></td>
</tr>
</tbody>
<p class="p">To use the device certificates stored in <a class="xref" href="https://www.microchip.com/wwwproducts/en/ATECC608A-TNGTLS" target="_blank">ATECC608A-TNGTLS</a>, enable the "Trust&amp;Go client certificate" option under the net service configurations. Make sure that you enable TLS in the MQTT configuration to use the client certificate during the TLS handshake.</p>
<br /><img class="image" src="GUID-C6D828F9-1C1E-4703-A05D-6C2D013480EF-low.png" alt="TNGTLS_ClientCert" /><br /><p class="p">All of the required files are automatically added into the MPLAB X IDE project by the MHC when the MQTT Service is selected for use.</p>
</table>
</div>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-6D4A7590-A5FE-418D-8A39-4F13DF7618BD.html">MQTT System Service</a></div>
</div>
</div></body>
</html>