<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="../../../favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="../../../assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2724382-16"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-2724382-16'); </script> <script type="text/javascript" src="../../../assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="../../../assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Net System Service Developer’s Guide | Microchip MPLAB Harmony PIC32MZW1 wireless system services help</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Net System Service Developer’s Guide" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Harmony 3 PIC32MZW1/WFI32 wireless system services" /> <meta property="og:description" content="Harmony 3 PIC32MZW1/WFI32 wireless system services" /> <link rel="canonical" href="../../../system/net/docs/developer.html" /> <meta property="og:url" content="../../../system/net/docs/developer.html" /> <meta property="og:site_name" content="Microchip MPLAB Harmony PIC32MZW1 wireless system services help" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Net System Service Developer’s Guide" /> <script type="application/ld+json"> {"@type":"WebPage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"../../assets/images/vendor/microchip_mplab_harmony_logo_150_transparent.png"}},"url":"../../../system/net/docs/developer.html","headline":"Net System Service Developer’s Guide","description":"Harmony 3 PIC32MZW1/WFI32 wireless system services","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="../../../index.html" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../" class="nav-list-link">Harmony 3 PIC32MZW1 wireless system services package</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../system/wifi/docs/readme.html" class="nav-list-link">Wi-Fi Service</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../../system/wifi/docs/configuration.html" class="nav-list-link">Wi-Fi System Service Configuration</a> </li><li class="nav-list-item "> <a href="../../../system/wifi/docs/developer_guide.html" class="nav-list-link">Wi-Fi System Service developer guide</a> </li><li class="nav-list-item "> <a href="../../../system/wifi/docs/usage.html" class="nav-list-link">Wi-Fi System Service Usage</a> </li><li class="nav-list-item "> <a href="../../../system/wifi/docs/interface.html" class="nav-list-link">Wi-Fi System Service Interface</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../system/wss/docs/readme.html" class="nav-list-link">Web Socket Server System Service</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../../system/wss/docs/developer.html" class="nav-list-link">Web Socket System Service Developer's Guide</a> </li><li class="nav-list-item "> <a href="../../../system/wss/docs/usage.html" class="nav-list-link">Web Socket Server System Service Usage</a> </li><li class="nav-list-item "> <a href="../../../system/wss/docs/interface.html" class="nav-list-link">Web Socket Server System Service Interface</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../system/appdebug/docs/readme.html" class="nav-list-link">App Debug Service</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../../system/appdebug/docs/configuration.html" class="nav-list-link">App Debug System Service Configuration</a> </li><li class="nav-list-item "> <a href="../../../system/appdebug/docs/usage.html" class="nav-list-link">App Debug System Service Usage</a> </li><li class="nav-list-item "> <a href="../../../system/appdebug/docs/interface.html" class="nav-list-link">App Debug System Service Interface</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../system/mqtt/docs/readme.html" class="nav-list-link">MQTT Service</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../../system/mqtt/docs/configuration.html" class="nav-list-link">MQTT System Service Configuration</a> </li><li class="nav-list-item "> <a href="../../../system/mqtt/docs/usage.html" class="nav-list-link">MQTT System Service Usage</a> </li><li class="nav-list-item "> <a href="../../../system/mqtt/docs/developer.html" class="nav-list-link">MQTT System Service Developer's Guide</a> </li><li class="nav-list-item "> <a href="../../../system/mqtt/docs/interface.html" class="nav-list-link">MQTT System Service Interface</a> </li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../system/net/docs/readme.html" class="nav-list-link">Net Service</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../../system/net/docs/configuration.html" class="nav-list-link">Net System Service Configuration</a> </li><li class="nav-list-item active"> <a href="../../../system/net/docs/developer.html" class="nav-list-link active">Net System Service Developer's Guide</a> </li><li class="nav-list-item "> <a href="../../../system/net/docs/usage.html" class="nav-list-link">Net System Service Usage</a> </li><li class="nav-list-item "> <a href="../../../system/net/docs/interface.html" class="nav-list-link">Net System Service Interface</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../system/wifiprov/docs/readme.html" class="nav-list-link">Wi-Fi provisioning Service</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../../system/wifiprov/docs/configuration.html" class="nav-list-link">Wi-Fi provisioning System Service Configuration</a> </li><li class="nav-list-item "> <a href="../../../system/wifiprov/docs/developer_guide.html" class="nav-list-link">Wi-Fi provisioning System Service developer guide</a> </li><li class="nav-list-item "> <a href="../../../system/wifiprov/docs/usage.html" class="nav-list-link">Wi-Fi provisioning System Service Usage</a> </li><li class="nav-list-item "> <a href="../../../system/wifiprov/docs/interface.html" class="nav-list-link">Wi-Fi provisioning System Service Interface</a> </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="../../../system/ota/docs/readme.html" class="nav-list-link">OTA Service</a><ul class="nav-list"><li class="nav-list-item "> <a href="../../../system/ota/docs/configuration.html" class="nav-list-link">OTA System Service Configuration</a> </li><li class="nav-list-item "> <a href="../../../system/ota/docs/usage.html" class="nav-list-link">OTA System Service Usage</a> </li><li class="nav-list-item "> <a href="../../../system/ota/docs/developer_guide.html" class="nav-list-link">OTA System Developer's guide</a> </li><li class="nav-list-item "> <a href="../../../system/ota/docs/interface.html" class="nav-list-link">OTA System Service Interface</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="../../../release_notes.html" class="nav-list-link">Release notes</a></li><li class="nav-list-item"><a href="../../../mplab_harmony_license.html" class="nav-list-link">License</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Microchip MPLAB Harmony PIC32MZW1 wireless system services help" aria-label="Search Microchip MPLAB Harmony PIC32MZW1 wireless system services help" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://support.microchip.com" class="site-button" > Obtain Support from Microchip </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="../../../">Harmony 3 PIC32MZW1 wireless system services package</a></li> <li class="breadcrumb-nav-list-item"><a href="../../../system/net/docs/readme.html">Net Service</a></li> <li class="breadcrumb-nav-list-item"><span>Net System Service Developer's Guide</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="net-system-service-developers-guide"> <a href="#net-system-service-developers-guide" aria-labelledby="net-system-service-developers-guide" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Net System Service Developer’s Guide </h1> <h3 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" aria-labelledby="table-of-contents" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents </h3> <ol id="markdown-toc"> <li><a href="#overview" id="markdown-toc-overview">Overview</a></li> <li><a href="#detailed-design" id="markdown-toc-detailed-design">Detailed Design</a> <ol> <li><a href="#state-machine" id="markdown-toc-state-machine">State Machine</a> <ol> <li><a href="#client-state-machine" id="markdown-toc-client-state-machine">Client State Machine</a></li> <li><a href="#server-state-machine" id="markdown-toc-server-state-machine">Server State Machine</a></li> </ol> </li> <li><a href="#number-of-sockets-supported" id="markdown-toc-number-of-sockets-supported">Number of Sockets Supported</a></li> <li><a href="#external-apis" id="markdown-toc-external-apis">External APIs</a> <ol> <li><a href="#sys_net_open-" id="markdown-toc-sys_net_open-">SYS_NET_Open ()</a></li> <li><a href="#sys_net_close-" id="markdown-toc-sys_net_close-">SYS_NET_Close ()</a></li> <li><a href="#sys_net_sendmsg-" id="markdown-toc-sys_net_sendmsg-">SYS_NET_SendMsg ()</a></li> <li><a href="#sys_net_recvmsg-" id="markdown-toc-sys_net_recvmsg-">SYS_NET_RecvMsg ()</a></li> <li><a href="#self-healing" id="markdown-toc-self-healing">Self-Healing</a></li> <li><a href="#sys_net_task-" id="markdown-toc-sys_net_task-">SYS_NET_Task ()</a></li> <li><a href="#sys_net_ctrlmsg-" id="markdown-toc-sys_net_ctrlmsg-">SYS_NET_CtrlMsg ()</a></li> <li><a href="#sys_net_initialize-sys_net_deinitialize" id="markdown-toc-sys_net_initialize-sys_net_deinitialize">SYS_NET_Initialize()/ SYS_NET_Deinitialize()</a></li> <li><a href="#sys_net_setconfigparam" id="markdown-toc-sys_net_setconfigparam">SYS_NET_SetConfigParam()</a></li> </ol> </li> <li><a href="#cli-commands" id="markdown-toc-cli-commands">CLI Commands</a></li> <li><a href="#code-location" id="markdown-toc-code-location">Code location</a></li> </ol> </li> <li><a href="#reference" id="markdown-toc-reference">Reference</a></li> </ol> <hr /> <p>The purpose of this document is to explain the NET system service design to enable the developer to make changes in the service code as per his/ her requirements if the need be.</p> <h1 id="overview"> <a href="#overview" aria-labelledby="overview" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Overview </h1> <p>NET system service Library provides an application programming interface (API) to manage TCP/IP Networking functionalities. The NET system service uses the MPLAB Harmony NetPres APIs for achieving these functionalities. It supports key features like Client/ Server Mode for IP Network Connectivity, TLS for TCP Connection, Self-Healing, etc.</p> <p align="center"> <img src="./images/Stack.png" style="width:1.8125in;height:3.53125in" /> </p> <p>Though the application developer is free to use the Harmony NetPres or TCP/ IP Stack APIs directly to manage the TCP/ IP Networking functionalities, the use of NET system service eases the work of the developer by reducing the state machine that the application needs to maintain while also reducing the amount of bookkeeping that otherwise is needed.</p> <h1 id="detailed-design"> <a href="#detailed-design" aria-labelledby="detailed-design" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Detailed Design </h1> <p>NET system service is a background service that runs in the context of the application task. The idea of the NET system service is to reduce the code size for the application and simplifying the state machine that the application may need to maintain by abstracting out the complexity in the system service. The system service achieves this by maintaining a state machine of its own and any bookkeeping that may be needed.</p> <p>The NET system service supports two modes – <a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/system/net/docs/interface.html#sys_net_mode_client"><em>CLIENT</em></a>, and <a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/system/net/docs/interface.html#sys_net_mode_server"><em>SERVER</em></a> for both the transport protocols – <a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/system/net/docs/interface.html#sys_net_ip_prot_tcp"><em>TCP</em></a> and <a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/system/net/docs/interface.html#sys_net_ip_prot_udp"><em>UDP</em></a>. Also, the service supports secured connections for TCP.</p> <p>The NET system service also supports Self-Healing, or ‘Auto-Reconnect’. In case there is an interruption in the connection due to the underlying lower layer or when the peer disconnects, the service tries to reconnect again without making the application to bother about retriggering the connection.</p> <h2 id="state-machine"> <a href="#state-machine" aria-labelledby="state-machine" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> State Machine </h2> <p>The various states of the NET system service are of the enum type <a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/system/net/docs/interface.html#sys_net_status"><em>SYS_NET_STATUS</em></a>. The Client and Server have a separate state machine. The application is expected to call <a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/system/net/docs/interface.html#sys_net_task"><em>SYS_NET_Task()</em></a> periodically from its own task context. This function ensures that the NET system service state machine receives sufficient execution cycles to process pending packets in the network stack.</p> <h3 id="client-state-machine"> <a href="#client-state-machine" aria-labelledby="client-state-machine" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Client State Machine </h3> <p>The NET system service runs a finite state machine with the following states in the ‘CLIENT’ mode:</p> <ol> <li> <p><em>SYS_NET_STATUS_IDLE</em>: Initial State of the NET system service, at the initialization.</p> </li> <li> <p><em>SYS_NET_STATUS_LOWER_LAYER_DOWN</em>:</p> <ol> <li> <p>State the NET system service enters after initialization.</p> </li> <li> <p>In this state, the NET system service checks for the operational status of the lower layer – Wi-Fi or Ethernet. If the link is down, the service remains in this state.</p> </li> <li> <p>Since this state monitors the link state, it offloads the application’s burden to poll the link before communicating over the network.</p> </li> </ol> </li> <li> <p><em>SYS_NET_STATUS_RESOLVING_DNS</em>: In this state, the service tries to resolve the server DNS to connect to it.</p> </li> <li> <p><em>SYS_NET_STATUS_DNS_RESOLVED</em>: In this state, the service has resolved the DNS and opens a socket to connect to the server.</p> </li> <li> <p><em>SYS_NET_STATUS_CLIENT_CONNECTING</em>: In this state, the service has resolved the DNS and opens a socket to connect to the server.</p> </li> <li> <p><em>SYS_NET_STATUS_WAIT_FOR_SNTP</em>:</p> <ol> <li> <p>Valid for Secured TCP Connection only.</p> </li> <li> <p>Service waits for the system to connect to the NTP server and get the time snapshot. This is required to validate the peer certificate.</p> </li> </ol> </li> <li> <p><em>SYS_NET_STATUS_TLS_NEGOTIATING</em>:</p> <ol> <li> <p>Valid for secured TCP connection only.</p> </li> <li> <p>TLS negotiation is in progress.</p> </li> </ol> </li> <li> <p><em>SYS_NET_STATUS_TLS_NEGOTIATION_FAILED</em>:</p> <ol> <li> <p>Valid for secured TCP connection only.</p> </li> <li> <p>TLS Negotiation failed. Failure conveyed to the application via the <a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/system/net/docs/interface.html#sys_net_callback">callback</a> registered with the service.</p> </li> </ol> </li> <li> <p><em>SYS_NET_STATUS_CONNECTED</em>: Client connected to the server; Connection status is conveyed to the application via the callback registered with the service. In this state, the service is waiting to receive data from the peer.</p> </li> <li> <p><em>SYS_NET_STATUS_SOCK_OPEN_FAILED</em>: Opening the Socket failed. Failure is conveyed to the application via the registered callback.</p> </li> <li> <p><em>SYS_NET_STATUS_DNS_RESOLVE_FAILED</em>: DNS for the server is not resolved because the DNS server is unavailable or due to misconfiguration w.r.t. server name. Failure is conveyed to the application via the registered callback.</p> </li> <li> <p><em>SYS_NET_STATUS_DISCONNECTED</em>: Client disconnected from the server. ‘Disconnection’ is conveyed to the application via the registered callback. If the application has enabled ‘Auto-Reconnect,’ the service shall switch to SYS_NET_STATUS_LOWER_LAYER_DOWN state and re-try to connect to the server.</p> </li> <li> <p><em>SYS_NET_STATUS_PEER_SENT_FIN</em>:</p> <ol> <li> <p>Valid for TCP Connection only</p> </li> <li> <p>The client received SYN FIN from the peer, which is conveyed to the application via the registered callback.</p> </li> </ol> </li> <li> <p><em>SYS_NET_STATUS_CONNECTED_LL_DOWN</em>: Lower layer went down while the client is connected to the server. This is conveyed to the application, but the service shall not take any action on this. The service expects the TCP/ IP Stack to take action as per the protocol standards. Since the application will be informed about this state, it is free to call NET system server API to disconnect the connection with the peer.</p> </li> </ol> <p align="center"> <img src="./images/ClientStateMachine.png" style="width:6.5in;height:3.35417in" /> </p> <p>The above state machine has been implemented in the function <em>SYS_NET_Client_Task()</em></p> <h3 id="server-state-machine"> <a href="#server-state-machine" aria-labelledby="server-state-machine" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Server State Machine </h3> <p>The NET system service runs a finite state machine with the following states valid in ‘SERVER’ mode:</p> <ol> <li> <p>SYS_NET_STATUS_IDLE: Initial State of the NET system service, at the initialization.</p> </li> <li> <p>SYS_NET_STATUS_LOWER_LAYER_DOWN:</p> <ol> <li> <p>State the NET system service enters after initialization.</p> </li> <li> <p>In this state, the NET system service checks for the operational status of the lower layer – Wi-Fi or Ethernet. If the link is down, the service remains in this state.</p> </li> <li> <p>The service shall open the socket if the lower layer link is Up.</p> </li> </ol> </li> <li> <p>SYS_NET_STATUS_SERVER_AWAITING_CONNECTION: Service waits for a connection from a client</p> </li> <li> <p>SYS_NET_STATUS_WAIT_FOR_SNTP:</p> <ol> <li> <p>Valid for Secured TCP Connection only.</p> </li> <li> <p>Service waits for the system to connect to the NTP server and get the time snapshot required to validate the peer certificate.</p> </li> </ol> </li> <li> <p>SYS_NET_STATUS_TLS_NEGOTIATING:</p> <ol> <li> <p>Valid for Secured TCP Connection only.</p> </li> <li> <p>TLS negotiation is in progress.</p> </li> </ol> </li> <li> <p>SYS_NET_STATUS_TLS_NEGOTIATION_FAILED:</p> <ol> <li> <p>Valid for secured TCP connection only.</p> </li> <li> <p>TLS negotiation failed. Failure is conveyed to the application via the <a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/system/net/docs/interface.html#sys_net_callback">callback</a> registered with the service.</p> </li> </ol> </li> <li> <p>SYS_NET_STATUS_CONNECTED: Client connected to the server; Connection Status is conveyed to the application via the callback registered with the service. In this state, the service is waiting for data from the peer.</p> </li> <li> <p>SYS_NET_STATUS_SOCK_OPEN_FAILED: Opening the Socket failed. Failure conveyed to the application via the registered callback.</p> </li> <li> <p>SYS_NET_STATUS_DISCONNECTED: Client disconnected from the server. ‘Disconnection’ is conveyed to the application via the registered callback. If the application has enabled ‘Auto-Reconnect’, the service shall open the socket again and switch to SYS_NET_STATUS_SERVER_AWAITING_CONNECTION, waiting for the client to reconnect.</p> </li> <li> <p>SYS_NET_STATUS_PEER_SENT_FIN:</p> <ol> <li> <p>Valid for TCP connection only</p> </li> <li> <p>The client received SYN FIN from the peer, which is conveyed to the application via the registered callback.</p> </li> </ol> </li> <li> <p>SYS_NET_STATUS_CONNECTED_LL_DOWN: Lower Layer went down while the server is connected to the client. This is conveyed to the application, but the service shall not take any action on this. The service expects the TCP/ IP Stack to take action as per the protocol standards. Since the application will be informed about this state, it is free to call NET system server API to disconnect the connection with the peer.</p> </li> </ol> <p align="center"> <img src="./images/ServerStateMachine.png" style="width:6.5in;height:3.16667in" /> </p> <p>The above state machine has been implemented in the function <em>SYS_NET_Server_Task()</em></p> <p><strong>In case the user wants to add or remove a state or modify the action to be done in an existing state (for instance, adding a timer for a time-bound result), one would need to modify the function <em>SYS_NET_Server_Task() or and SYS_NET_Client_Task()</em> along with the enum <em><a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/system/net/docs/interface.html#sys_net_status">SYS_NET_STATUS</a>.</em></strong></p> <h2 id="number-of-sockets-supported"> <a href="#number-of-sockets-supported" aria-labelledby="number-of-sockets-supported" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Number of Sockets Supported </h2> <p>The number of sockets supported by NET system service currently is 2. <strong>The same can be increased by changing the value of the macro <a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/system/net/docs/interface.html#sys_net_max_num_of_sockets"><em>SYS_NET_MAX_NUM_OF_SOCKETS</em></a></strong>. One can also configure the number of sockets via the MHC.</p> <h2 id="external-apis"> <a href="#external-apis" aria-labelledby="external-apis" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> External APIs </h2> <h3 id="sys_net_open-"> <a href="#sys_net_open-" aria-labelledby="sys_net_open-" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/system/net/docs/interface.html#sys_net_open">SYS_NET_Open ()</a> </h3> <p>Description: The API is used for opening the socket for either TCP or UDP in Client or Server Mode. The user needs to register a callback function via this API. The registered callback lets the user know the operational status change or when data is received on the socket. One of the advantages of this API is that the user can open a socket without bothering about the operational state of the underlying layers, and the service shall take care of all the complexity in such cases.</p> <p align="center"> <img src="./images/SYS_NET_Open.png" style="width:6.84375in;height:6.91667in" /> </p> <h3 id="sys_net_close-"> <a href="#sys_net_close-" aria-labelledby="sys_net_close-" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/system/net/docs/interface.html#sys_net_close">SYS_NET_Close ()</a> </h3> <p>Description: This API is used for closing the socket connection with the peer.</p> <p align="center"> <img src="./images/SYS_NET_Close.png" style="width:6.48958in;height:2.63542in" /> </p> <h3 id="sys_net_sendmsg-"> <a href="#sys_net_sendmsg-" aria-labelledby="sys_net_sendmsg-" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/system/net/docs/interface.html#sys_net_sendmsg">SYS_NET_SendMsg ()</a> </h3> <p>Description: This API is used for transmitting the data to the peer on this socket connection.</p> <p align="center"> <img src="./images/SYS_NET_SendMsg.png" style="width:6.48958in;height:4in" /> </p> <h3 id="sys_net_recvmsg-"> <a href="#sys_net_recvmsg-" aria-labelledby="sys_net_recvmsg-" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/system/net/docs/interface.html#sys_net_recvmsg">SYS_NET_RecvMsg ()</a> </h3> <p>Description: This API is used for receiving data sent in by the peer on the socket connection.</p> <p align="center"> <img src="./images/SYS_NET_RecvMsg.png" style="width:6.48958in;height:4.73958in" /> </p> <h3 id="self-healing"> <a href="#self-healing" aria-labelledby="self-healing" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Self-Healing </h3> <p>Description: Self-Healing, or ‘Auto-Reconnect’ is a feature supported by NET system service where in case there is an interruption in the connection due to the underlying lower layer or when the peer disconnects, the service tries to reconnect again without making the application to bother about retriggering the connection</p> <p align="center"> <img src="./images/Self-Healing.png" style="width:6.5in;height:6.63542in" /> </p> <h3 id="sys_net_task-"> <a href="#sys_net_task-" aria-labelledby="sys_net_task-" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SYS_NET_Task () </h3> <p>Description: This API is used for smooth functioning of the state machine of the NET system service<strong>.</strong> The application needs to call this API periodically. Also, this API takes as parameter the handle returned when we open the socket via the SYS_NET_Open() call. So in case the user opens two sockets, he/ she will need to call SYS_NET_Task() perdiocially for each of the socket connections.</p> <h3 id="sys_net_ctrlmsg-"> <a href="#sys_net_ctrlmsg-" aria-labelledby="sys_net_ctrlmsg-" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SYS_NET_CtrlMsg () </h3> <p>Description: This API is used for Reconnecting or Disconnecting an existing connection. <strong>The user can scale this API for triggering other actions if the need be. One of the parameters this API takes is the enum <a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/system/net/docs/interface.html#sys_net_ctrl_msg">SYS_NET_CTRL_MSG</a> which the user can expand to add on new message type and add a new case in the switch condition of this API to trigger the new action.</strong></p> <h3 id="sys_net_initialize-sys_net_deinitialize"> <a href="#sys_net_initialize-sys_net_deinitialize" aria-labelledby="sys_net_initialize-sys_net_deinitialize" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/docs/system/net/docs/interface.html#sys_net_initialize">SYS_NET_Initialize</a>()/ <a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/docs/system/net/docs/interface.html#sys_net_deinitialize">SYS_NET_Deinitialize()</a> </h3> <p>Description: These functions are used for initializing/ deinitializing the data structures of the NET system service. The SYS_NET_Initialize() function is called from within the System Task. <strong>Users can modify these functions in case they want to take some additional actions during the initialization of the service.</strong></p> <h3 id="sys_net_setconfigparam"> <a href="#sys_net_setconfigparam" aria-labelledby="sys_net_setconfigparam" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/docs/system/net/docs/interface.html#sys_net_setconfigparam">SYS_NET_SetConfigParam()</a> </h3> <p>Description: The API is currently used for configuring the parameter – ‘auto_reconnect’ after the user has called SYS_NET_Open(). <strong>The user can modify this API to add other configuration parameters which he/ she may want to change.</strong> Please note that some of the configuration parameters will come into effect only after the socket reconnects.</p> <h2 id="cli-commands"> <a href="#cli-commands" aria-labelledby="cli-commands" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> CLI Commands </h2> <p>The details of the cli commands supported by NET system service can be found <a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/docs/system/net/docs/usage.html">here</a>. The CLI commands are implemented using the function <em>SysNet_Command_Process()</em>. <strong>The users can modify any of the commands – configuration or get as per their needs by modifying the above function.</strong></p> <h2 id="code-location"> <a href="#code-location" aria-labelledby="code-location" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Code location </h2> <p>The base code for the NET system service can be found in the <em>wireless_system_pic32mzw1_wfi32e01\system\net</em></p> <p>The same shall be copied to the following location after the code for the application is generated – <em>my_application\firmware\src\config\pic32mz_w1_curiosity\system\net</em></p> <p>The code has 2 files:</p> <ol> <li> <p>Header file: <em>sys_net.h</em></p> </li> <li> <p>Source file: <em>src/sys_net.c</em></p> </li> </ol> <blockquote> <p>Since the above files could see modifications across releases, hence the users would need to take care of merging the changes they did in these files with the ones which were done in the new release by Microchip Team. For this the user needs to take care of this while generating the code via the MHC:</p> </blockquote> <p align="center"> <img src="./images/MhcMergeStrategy.png" style="width:6.5in;height:6.67639in" /> </p> <p>While generating the code the user should use the Merge Strategy as “USER_ALL”, and press “Generate”. In case there are changes done by user in any of the files, the MHC shall prompt the user about it:</p> <p align="center"> <img src="./images/MhcMergeWindow.png" style="width:6.5in;height:3.16528in" /> </p> <p>The user can merge his changes with the the latest changes done in the services using the above window.</p> <h1 id="reference"> <a href="#reference" aria-labelledby="reference" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Reference </h1> <div class="table-wrapper"><table> <thead> <tr> <th>S. No</th> <th>Name</th> <th>Link</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>NET system service Usage</td> <td><a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/docs/system/net/docs/usage.html">https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/docs/system/net/docs/usage.html</a></td> </tr> <tr> <td>2</td> <td>NET system service Interface</td> <td><a href="https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/docs/system/net/docs/interface.html">https://microchip-mplab-harmony.github.io/wireless_system_pic32mzw1_wfi32e01/docs/system/net/docs/interface.html</a></td> </tr> </tbody> </table></div> <hr> <footer> <p class="text-small text-grey-dk-000 mb-0"><img src='https://raw.githubusercontent.com/wiki/Microchip-MPLAB-Harmony/Microchip-MPLAB-Harmony.github.io/images/microchip_logo.png' /><br />Copyright &copy; 2020 Microchip Technology.</p> <!-- <p class="text-small text-grey-dk-000 mb-0"><img src='../../../assets/images/vendor/microchip_logo.png' /><br /> Copyright &copy; 2021 Microchip Technology.</p> --> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
